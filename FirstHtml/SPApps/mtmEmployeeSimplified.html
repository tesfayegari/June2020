<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<div class="employeees container-fluid mt-5">

  <!-- Search area  -->
  <div class="container">
    <div class="input-group mb-3">
      <input type="search" class="form-control" placeholder="Search by Department" id="searchText">
      <div class="input-group-append">
        <input class="btn btn-primary ml-0" type="button" id="searchButton" value="Search">
      </div>
    </div>
  </div>
  <!-- Search ended  -->

  <!-- Employee display  -->
  <div class="row" id="employees">
   
  </div>
  <!-- end of employees  -->

  <!-- Pagination  -->
  <div class="container mt-3">
    <nav>
      <ul class="pagination justify-content-center">
        <li class="page-item">
          <a class="page-link" href="#" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
            <span class="sr-only">Previous</span>
          </a>
        </li>
        <li class="page-item disabled"><a class="page-link" href="#">Page - 1</a></li>
        
        <li class="page-item">
          <a class="page-link" href="#" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
            <span class="sr-only">Next</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
  <!-- end of pagination  -->

</div>

<script>
 //global variable 
 var nextUrl;
  //using jQuery Ajax the following returns Promise to All List Items from list name
  //Search items by department
  function getItemsByUrl(restUrl) {
    return $.ajax({
      url: restUrl,
      method: "GET",
      headers: { "Accept": "application/json; odata=nometadata" }
    });
  }

  //render Employee custom function which creates an html and injects to the above DOM with id employees
  function renderEmployees(employees) {
    var emplsHtml = '';

    for (var index in employees) {
      emplsHtml += buildEmployeeHtml(employees[index]);
    }

    $('#employees').html(emplsHtml);
  }

  //Build Employee HTML 
  function buildEmployeeHtml(employee) {
    return `
    <div class="col-md-4">
      <div class="card">
        <img class="card-img-top"
          src="https://tgarillc.sharepoint.com/sites/playground/Galleries/${employee.PictureFileName}"
          alt="Card image cap">
        <div class="card-body">
          <h5 class="card-title">${employee.Title}</h5>
          <ul class="list-group">
            <li class="list-group-item">${employee.Phone}</li>
            <li class="list-group-item">${employee.Email}</li>
            <li class="list-group-item">${employee.Department}</li>
          </ul>
          <a href="#" class="btn btn-primary mt-2">View Profile</a>
        </div>
      </div>
    </div>
    `;
  }
  
  function renderEmp(url) {
      getItemsByUrl(url)
        .then(function (response) {
          //data is successfully returned here
          console.log('Data is back from first call', response);
          nextUrl = response["odata.nextLink"];
          var employees = response.value; //array of list items        
          renderEmployees(employees);
          //end of success 
        }, function (error) { console.error('Oops error occured', error); });
    }

  //end of renderEmployee

  $(document).ready(function () {
    //call readItems function by passing listName parameter which will return a promise
    var url = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('MTMEmployees')/items?$orderby=Title&$top=9";
    renderEmp(url);  
    
    //search button clicked 
    $('#searchButton').click(function () {
      //Search click handler 
      var searchText = $('#searchText').val();
      if (searchText == '') {
        alert('Search Text can not be empty');
        return;
      }
      url = _spPageContextInfo.webAbsoluteUrl + "/_api/web/lists/getbytitle('MTMEmployees')/items?$filter=Department eq '" + searchText + "'&$orderby=Title&$top=9";
      renderEmp(url);      

    });




  });

</script>